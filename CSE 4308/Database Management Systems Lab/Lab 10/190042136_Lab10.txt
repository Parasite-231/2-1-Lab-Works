--Task 01


set serveroutput on;

create 
or replace function total_items_shipped (in_year int) 
return number 
is 
total_shipped number(12, 5) := 0;

begin 

select 
  sum(quantity) into total_shipped 
from 
  orders, 
  order_items 
where 
  orders.order_id = order_items.order_id 
  and order_year = in_year 
  and orders.status = 1;

return total_shipped;
end;
/ 

begin
dbms_output.put('Output : ');
dbms_output.put('2002 - '||total_items_shipped(2002));
dbms_output.put(', ');
dbms_output.put('2006 - '||total_items_shipped(2006));
dbms_output.put(', ');
dbms_output.put_line('2017 - '||total_items_shipped(2017));
end;
/

Output : 2002 - 432, 2006 - 934, 2017 - 1188


--Task 02


set serveroutput on;

create 
or replace function most_sold_item (in_year int) 
return number 
is 
maximum_quantity_sold number(12, 5) := 0;
id_of_most_sold_item number(12, 5) := 0;

begin 

select 
  max(sum(quantity)) into maximum_quantity_sold 
from 
  order_items, 
  orders 
where 
  order_items.order_id = orders.order_id 
  and orders.status = 1 
  and order_year = in_year 
group by 
  item_id;

select 
  item_id into id_of_most_sold_item 
from 
  (select item_id, sum(quantity) as total_quantity_shipped 
    from 
      order_items, 
      orders 
    where 
      orders.order_id = order_items.order_id 
      and orders.status = 1 
      and order_year = in_year 
    group by 
      item_id
  ) 
where 
  total_quantity_shipped = maximum_quantity_sold;

return id_of_most_sold_item;
end;
/

begin
dbms_output.put('Output : ');
dbms_output.put('2002 - '||most_sold_item(2002));
dbms_output.put(', ');
dbms_output.put('2006 - '||most_sold_item(2006));
dbms_output.put(', ');
dbms_output.put_line('2017 - '||most_sold_item(2017));
end;
/

Output : 2002 - 4, 2006 - 2, 2017 - 3


--Task 03


set serveroutput on;

create 
or replace function profit_estimation (year number) 
return varchar2 
is 
total_revenue_generated number(22, 5) := 0;
total_revenue_lost number(22, 5) := 0;
profit_outcome number(22, 5) := 0;
year_outcome varchar2(100);
total_revenue number(22, 5) := 0;

begin 

select 
  sum(quantity * ppu) into total_revenue_generated 
from 
  order_items, 
  orders 
where 
  order_items.order_id = orders.order_id 
  and orders.status = 1 
  and order_year = year;

select 
  sum(quantity * ppu) into total_revenue_lost 
from 
  order_items, 
  orders 
where 
  order_items.order_id = orders.order_id 
  and orders.status = 0 
  and order_year = year;

total_revenue := total_revenue_generated + total_revenue_lost;

profit_outcome := (total_revenue_generated / total_revenue)* 100;

IF profit_outcome BETWEEN 50 AND 65 THEN 
year_outcome := '(Average Year)';

ELSIF profit_outcome BETWEEN 66 AND 79 THEN 
year_outcome := '(Good Year)';

ELSIF profit_outcome > 79 THEN 
year_outcome := '(Excellent Year)';

ELSE 
year_outcome := '(A year of losses)';

END IF;

RETURN year_outcome;
END;
/
 
set 
  serveroutput on;

--Function to get the value of the total revenue generated by the sale of shipped items for a particular year.
create 
or replace function total_revenue_generated_for_saling_shipped_items (year number) 
return number 
is 
total_revenue_generated number(22, 5) := 0;
total_revenue_lost number(22, 5) := 0;
profit_outcome number(22, 5) := 0;
year_outcome varchar2(100);
total_revenue number(22, 5) := 0;

begin 

select 
  sum(quantity * ppu) into total_revenue_generated 
from 
  order_items, 
  orders 
where 
  order_items.order_id = orders.order_id 
  and orders.status = 1 
  and order_year = year;

return total_revenue_generated;
end;
/

begin
dbms_output.put('Output : ');
dbms_output.put('2002 - ');
dbms_output.put(total_revenue_generated_for_saling_shipped_items(2002));
dbms_output.put(profit_estimation(2002));
dbms_output.put(', 2006 - ');
dbms_output.put(total_revenue_generated_for_saling_shipped_items(2006));
dbms_output.put(profit_estimation(2006));
dbms_output.put(', 2017 - ');
dbms_output.put(total_revenue_generated_for_saling_shipped_items(2017));
dbms_output.put_line(profit_estimation(2017));
end;
/

Output : 2002 - 2789(A year of losses), 2006 - 6346(Good Year), 2017 -
8198(Average Year)